❯ what's the best process to replace a homebrew formula if the original formula maintainer is not reachable

⏺ For replacing or taking over maintenance of a Homebrew formula when the original maintainer is unreachable, here's the recommended process:

  1. Check the Formula Location

  - Core formulas (homebrew-core): Maintained by Homebrew team
  - Tap formulas (e.g., username/tap): Maintained by individual maintainers

  2. For Core Formulas

  Submit a PR to homebrew/homebrew-core:
  # Fork and clone homebrew-core
  cd $(brew --repository homebrew/core)
  git checkout -b update-formula-name

  # Edit the formula
  brew edit formula-name

  # Test it
  brew install --build-from-source formula-name
  brew test formula-name
  brew audit --strict formula-name

  # Submit PR

  3. For Third-Party Taps

  Several options:

  Option A: Contact via GitHub Issues
  - Open an issue in the tap repository
  - Wait a reasonable time (2-4 weeks)
  - Document your attempts to contact

  Option B: Fork the Tap
  # Create your own tap
  brew tap yourusername/yourtap
  cd $(brew --repository yourusername/yourtap)

  # Copy and update the formula
  cp /path/to/old/formula.rb Formula/formula.rb
  git add Formula/formula.rb
  git commit -m "Add formula (forked from inactive tap)"
  git push

  Option C: Request Transfer
  - If it's on GitHub, you can request repository transfer
  - Contact GitHub support if owner is truly unreachable
  - Document your maintenance history

  4. Create a New Tap (Clean Slate)

  # Create new repository on GitHub: yourusername/homebrew-yourtap
  brew tap-new yourusername/yourtap
  cd $(brew --repository yourusername/yourtap)

  # Create the formula
  brew create https://url-to-source/archive.tar.gz
  # Edit Formula/yourformula.rb as needed

  git add Formula/yourformula.rb
  git commit -m "Add yourformula formula"
  git push

  5. Best Practices

  - Document everything: Keep records of contact attempts
  - Respect licensing: Ensure you comply with the original license
  - Give credit: Mention original maintainer in commits/README
  - Announce changes: If you fork, announce it clearly so users know where to go
  - Maintain compatibility: Try to keep the same formula name if possible

  6. Recommended Approach

  For most cases, I'd recommend:

  1. Open an issue in the original tap (if possible)
  2. Wait 2-3 weeks for response
  3. Fork the tap with clear documentation about the fork
  4. Announce the fork in the original repository's issues
  5. Keep your fork name similar (e.g., username/homebrew-formulaname)

  This way users can easily migrate with:
  brew untap old/tap
  brew tap your/tap

  Would you like help with a specific formula you're trying to maintain?

❯ how can i list in a formula that the old formula must be uninstalled

⏺ You can use the conflicts_with directive in your Homebrew formula to specify that another formula must be uninstalled first:

  Basic Conflict Declaration

  class YourFormula < Formula
    desc "Your package description"
    homepage "https://example.com"
    url "https://example.com/archive.tar.gz"
    sha256 "..."

    # Conflicts with the old formula
    conflicts_with "old-formula-name", because: "both install the same binaries"

    def install
      # ... installation steps
    end
  end

  Common Conflict Scenarios

  1. Replacing a Formula from Another Tap

  conflicts_with "olduser/oldtap/formula-name",
                 because: "this is a maintained fork of the original"

  2. Multiple Binaries Conflict

  conflicts_with "other-formula",
                 because: "both install 'command-name' executable"

  3. Multiple Conflicts

  conflicts_with "formula-one", because: "both install same binaries"
  conflicts_with "formula-two", because: "incompatible versions"

  Migration Pattern (Recommended)

  For a smoother migration, you can also include deprecation information:

  class NewFormula < Formula
    desc "Maintained fork of old-formula"
    homepage "https://github.com/newuser/repo"
    url "https://github.com/newuser/repo/archive/v1.0.0.tar.gz"
    sha256 "..."

    conflicts_with "old-formula",
                   because: "this is the maintained replacement"

    def install
      bin.install "binary-name"
      # ... other installation steps
    end

    def caveats
      <<~EOS
        This formula replaces 'old-formula' which is no longer maintained.

        To migrate from old-formula:
          brew uninstall old-formula
          brew install #{name}
      EOS
    end
  end

  User Experience

  When a user tries to install with a conflict, they'll see:

  $ brew install new-formula
  Error: Cannot install new-formula because conflicting formulae are installed.
    old-formula: both install the same binaries

  Please `brew uninstall old-formula` before continuing.

  Complete Example

  Here's a complete example for replacing a formula:

  class DialogTool < Formula
    desc "Development environment for Dialog interactive fiction"
    homepage "https://github.com/yourusername/dialog-tool"
    url "https://github.com/yourusername/dialog-tool/archive/v1.0.0.tar.gz"
    sha256 "abc123..."
    license "EPL-2.0"

    depends_on "babashka"

    # Prevent installation alongside old formula
    conflicts_with "olduser/oldtap/dialog-tool",
                   because: "this is the actively maintained fork"

    def install
      bin.install "dgt"
      # ... other files
    end

    def caveats
      <<~EOS
        This formula has replaced olduser/oldtap/dialog-tool.

        If migrating, first run:
          brew uninstall olduser/oldtap/dialog-tool
          brew untap olduser/oldtap
      EOS
    end

    test do
      system "#{bin}/dgt", "--version"
    end
  end

  Alternative: Deprecation in Old Tap

  If you have any way to update the old tap (even via PR), you can add a deprecation notice:

  class OldFormula < Formula
    # ... existing formula code ...

    deprecate! date: "2024-01-01", because: "is no longer maintained"

    def caveats
      <<~EOS
        This formula is deprecated and no longer maintained.
        Please switch to the maintained fork:

          brew uninstall old-formula
          brew tap newuser/newtap
          brew install new-formula
      EOS
    end
  end

  Best Practice Summary

  1. Use conflicts_with to prevent simultaneous installation
  2. Add helpful caveats with migration instructions
  3. Document in your README how users should migrate
  4. Announce the fork prominently in both repos (if possible)

  This ensures users get clear guidance when they encounter the conflict.

❯ how do you test a brew formula locally?

⏺ Here's how to test a Homebrew formula locally during development:

  1. Basic Local Installation Test

  # Install from local formula file
  brew install --build-from-source /path/to/your-formula.rb

  # Or if in a tap repository
  cd $(brew --repository youruser/yourtap)
  brew install --build-from-source Formula/your-formula.rb

  2. Complete Testing Workflow

  # 1. Audit the formula (check for issues)
  brew audit --strict --online your-formula

  # 2. Style check
  brew style your-formula

  # 3. Install from source
  brew install --build-from-source your-formula

  # 4. Run formula tests
  brew test your-formula

  # 5. Check linkage (dependencies)
  brew linkage your-formula

  # 6. Test upgrade path (if updating)
  brew upgrade your-formula

  # 7. Uninstall to verify cleanup
  brew uninstall your-formula

  3. Testing in Clean Environment

  The most thorough test is using a clean macOS environment:

  # Test in a fresh environment (recommended before publishing)
  brew test-bot --tap=youruser/yourtap your-formula

  4. Development Cycle Pattern

  # While developing, use this loop:

  # Edit formula
  brew edit your-formula

  # Uninstall previous version
  brew uninstall your-formula

  # Reinstall with verbose output to see what's happening
  brew install --build-from-source --verbose --debug your-formula

  # Test it works
  your-command --version

  # Run formula's test block
  brew test your-formula

  5. Testing a Formula Before Creating a Tap

  If you just have a formula file:

  # Create a temporary formula
  brew create https://github.com/user/repo/archive/v1.0.0.tar.gz

  # This opens editor - add your formula content

  # Install it
  brew install --build-from-source your-formula

  # Test it
  brew test your-formula

  # Formula is located at:
  # $(brew --repository)/Library/Taps/homebrew/homebrew-core/Formula/your-formula.rb

  6. Testing with a Local Tap

  # Create a local tap for testing
  mkdir -p ~/homebrew-testing/Formula
  cd ~/homebrew-testing

  # Initialize as git repo
  git init
  git add Formula/your-formula.rb
  git commit -m "Initial formula"

  # Tap it locally
  brew tap youruser/testing ~/homebrew-testing

  # Install from your local tap
  brew install youruser/testing/your-formula

  # When done testing
  brew untap youruser/testing

  7. Debug Installation Issues

  # Install with full debug output
  brew install --debug --verbose your-formula

  # This will:
  # - Show all commands being run
  # - Stop on errors
  # - Drop you into a shell if it fails

  # Check what files were installed
  brew list your-formula

  # See installation location
  brew --prefix your-formula

  8. Testing Specific Scenarios

  # Test on different macOS versions (if you have access)
  # - macOS Ventura (13.x)
  # - macOS Sonoma (14.x)
  # - macOS Sequoia (15.x)

  # Test on both architectures
  # - Intel (x86_64)
  # - Apple Silicon (arm64)

  # Check architecture-specific issues
  brew install --build-from-source your-formula
  file $(brew --prefix your-formula)/bin/your-binary

  9. Common Test Commands

  # Verify dependencies are correct
  brew deps your-formula
  brew uses --installed your-formula

  # Check for security issues
  brew audit --new-formula your-formula

  # Verify bottle (pre-built binary) compatibility
  brew bottle your-formula

  # Test the formula's test block
  brew test your-formula

  10. Example Test Script

  Create a test script for consistent testing:

  #!/bin/bash
  # test-formula.sh

  FORMULA_NAME="your-formula"

  echo "==> Cleaning up any existing installation"
  brew uninstall --force $FORMULA_NAME 2>/dev/null || true

  echo "==> Running audit"
  brew audit --strict --online $FORMULA_NAME

  echo "==> Running style check"
  brew style $FORMULA_NAME

  echo "==> Installing from source"
  brew install --build-from-source $FORMULA_NAME

  echo "==> Running tests"
  brew test $FORMULA_NAME

  echo "==> Checking linkage"
  brew linkage $FORMULA_NAME

  echo "==> Verifying installation"
  $FORMULA_NAME --version

  echo "==> Cleaning up"
  brew uninstall $FORMULA_NAME

  echo "✅ All tests passed!"

  11. Formula Test Block Example

  Make sure your formula has a good test block:

  class YourFormula < Formula
    # ... formula details ...

    test do
      # Test that the binary exists and runs
      assert_match version.to_s, shell_output("#{bin}/your-binary --version")

      # Test basic functionality
      system bin/"your-binary", "some-command"

      # Check that files were installed correctly
      assert_predicate bin/"your-binary", :exist?
      assert_predicate bin/"your-binary", :executable?

      # Test with a temporary directory
      testpath.cd do
        system bin/"your-binary", "init"
        assert_predicate testpath/"config.yml", :exist?
      end
    end
  end

  12. CI Testing (GitHub Actions)

  For automated testing, add to your tap repository:

  # .github/workflows/tests.yml
  name: brew test-bot

  on:
    pull_request:
    push:
      branches:
        - main

  jobs:
    test-bot:
      runs-on: macos-latest
      steps:
        - name: Set up Homebrew
          uses: Homebrew/actions/setup-homebrew@master

        - name: Run brew test-bot
          run: |
            brew test-bot --tap=${{ github.repository }}

  Quick Reference Card

  # Essential commands for local testing
  brew edit your-formula              # Edit formula
  brew audit --strict your-formula    # Check for issues
  brew style your-formula             # Style check
  brew install --build-from-source    # Install from source
  brew test your-formula              # Run tests
  brew uninstall your-formula         # Clean up

  This gives you a complete testing workflow from development to release!